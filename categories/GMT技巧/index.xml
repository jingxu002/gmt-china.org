<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>GMT 中文社区</title>
    <link>http://gmt-china.org/categories/GMT%E6%8A%80%E5%B7%A7/index.xml</link>
    <description>Recent content on GMT 中文社区</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cmn-Hans</language>
    <managingEditor>admin@gmt-china.org (GMT 中文社区)</managingEditor>
    <webMaster>admin@gmt-china.org (GMT 中文社区)</webMaster>
    <copyright>Powered by [Hugo](https://gohugo.io) &amp; Hosted by [GitHub](https://github.com/gmt-china/gmt-china.org).</copyright>
    <atom:link href="http://gmt-china.org/categories/GMT%E6%8A%80%E5%B7%A7/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>为子图添加编号</title>
      <link>http://gmt-china.org/blog/numbering-subfigures/</link>
      <pubDate>Mon, 17 Oct 2016 00:00:00 +0000</pubDate>
      <author>admin@gmt-china.org (GMT 中文社区)</author>
      <guid>http://gmt-china.org/blog/numbering-subfigures/</guid>
      <description>&lt;p&gt;在绘制组合图（即一张图由多张子图组成）时，需要在每张子图的左上角加上 a、b、c、d 等子图编号。常规的方法是根据子图的 &lt;code&gt;-R&lt;/code&gt; 选项的范围估计编号在当前子图里的坐标，然后使用 &lt;code&gt;pstext&lt;/code&gt; 模块将编号写在坐标所在的位置。此方法的一个明显缺点是，当 &lt;code&gt;-R&lt;/code&gt; 选项发生变化时，子图编号的坐标也需要发生变化。&lt;/p&gt;

&lt;p&gt;其实，GMT5 的 &lt;code&gt;pstext&lt;/code&gt; 模块提供了一个功能，可以用于灵活地进行子图编号。如下脚本所示：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#!/bin/bash
J=X5c/3c
R=0/5/0/3
PS=figures.ps

gmt psbasemap -J$J -R$R -Ba -BWSen -K &amp;gt; $PS
echo &amp;quot;a&amp;quot; | gmt pstext -J$J -R$R -F+cTL+f15p,1 -Dj-1c/-0.75c -N -K -O &amp;gt;&amp;gt; $PS

gmt psbasemap -J$J -R$R -Ba -BWSen -K -O -X7c &amp;gt;&amp;gt; $PS
echo &amp;quot;b&amp;quot; | gmt pstext -J$J -R$R -F+cTL+f15p,1 -Dj-1c/-0.75c -N -K -O &amp;gt;&amp;gt; $PS

gmt psxy -J$J -R$R -T -O &amp;gt;&amp;gt; $PS
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;结果如下图所示：
&lt;img src=&#34;http://gmt-china.org/images/numbering-subfigures.png&#34; alt=&#34;子图编号&#34; /&gt;&lt;/p&gt;

&lt;p&gt;几点说明：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;+cTL&lt;/code&gt; 的作用是从 &lt;code&gt;-R&lt;/code&gt; 选项中提取底图的左上角（&lt;strong&gt;T&lt;/strong&gt;op &lt;strong&gt;L&lt;/strong&gt;eft）作为当前字符串的坐标；&lt;/li&gt;
&lt;li&gt;由于使用了 &lt;code&gt;+cTL&lt;/code&gt;，因而 &lt;code&gt;pstext&lt;/code&gt; 不再需要 XY 坐标信息，只需要给出字符串 &lt;code&gt;a&lt;/code&gt;、&lt;code&gt;b&lt;/code&gt; 即可；&lt;/li&gt;
&lt;li&gt;&lt;code&gt;+f15p,1&lt;/code&gt; 将编号字号设置为 &lt;code&gt;15p&lt;/code&gt;，1号字体（即粗体）&lt;/li&gt;
&lt;li&gt;将编号放在左上角还不够，还需要使用 &lt;code&gt;-Dj-1c/-0.75c&lt;/code&gt; 对编号的位置进行微调，此处表示将编号向左边移动 1 cm 向上移动 0.75 cm&lt;/li&gt;
&lt;li&gt;由于编号位于子图的外部，故而需要加上 &lt;code&gt;-N&lt;/code&gt; 选项使得 &lt;code&gt;pstext&lt;/code&gt; 绘制子图外部的字符串&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>生成多页PS/PDF文件</title>
      <link>http://gmt-china.org/blog/multipage-ps/</link>
      <pubDate>Wed, 12 Oct 2016 00:00:00 +0000</pubDate>
      <author>admin@gmt-china.org (GMT 中文社区)</author>
      <guid>http://gmt-china.org/blog/multipage-ps/</guid>
      <description>&lt;p&gt;通常，在使用GMT画图时都是一个PS文件中保存一张图。因而，在需要画很多张同类型的图时，就需要生成很多个PS文件。比如要画1000个台站的波形数据，每张图只能放下20个波形，那么就需要写个循环画50张图，最终得到50个PS文件。有没有可能生成一个多页文件，每一页一张图呢？&lt;/p&gt;

&lt;p&gt;常规的做法是：先生成一堆PS文件，然后利用 &lt;code&gt;gmt psconvert -TF -Fout.pdf *.ps&lt;/code&gt;
将所有PS文件转换成一个多页PDF文件 &lt;code&gt;out.pdf&lt;/code&gt; ，最后把生成的PS文件删除。&lt;/p&gt;

&lt;p&gt;另一种做法是，直接生成一个多页PS文件，也就是把原来的脚本做小小的修改，使得所有绘图命令的输出都重定向到同一个PS文件中。比如，下面这个示例代码会生成10个PS文件，每个PS文件上写一个数字：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#!/bin/bash

J=X10c/10c
R=0/10/0/10
for (( i = 0; i &amp;lt; 10; i++)); do
    PS=map_$i.ps
    gmt psxy -J$J -R$R -T -K &amp;gt; $PS
    echo 5 5 $i | gmt pstext -J$J -R$R -B1 -F+f50p -K -O &amp;gt;&amp;gt; $PS
    gmt psxy -J$J -R$R -T -O &amp;gt;&amp;gt; $PS
done
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;对上面的代码做一点微小的改动：&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#!/bin/bash

J=X10c/10c
R=0/10/0/10
PS=map.ps

[ -e $PS ] &amp;amp;&amp;amp; rm $PS

for (( i = 0; i &amp;lt; 10; i++)); do
    gmt psxy -J$J -R$R -T -K &amp;gt;&amp;gt; $PS
    echo 5 5 $i | gmt pstext -J$J -R$R -B1 -F+f50p -K -O &amp;gt;&amp;gt; $PS
    gmt psxy -J$J -R$R -T -O &amp;gt;&amp;gt; $PS
done
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;改动主要有三点：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;将变量 &lt;code&gt;PS&lt;/code&gt; 的定义放在了循环外部，意味着所有命令的输出都会保存到一个PS文件中&lt;/li&gt;
&lt;li&gt;第一个绘图命令的 &lt;code&gt;&amp;gt;&lt;/code&gt; 改成了 &lt;code&gt;&amp;gt;&amp;gt;&lt;/code&gt; ，以保证每次循环时不会新建PS文件&lt;/li&gt;
&lt;li&gt;循环开始前判断PS文件是否存在，若存在则删除，以避免多次执行脚本时将多次执行的结果写到同一个文件中&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;经过这样的改动之后，就生成了一个多页PS文件。可以使用&lt;code&gt;gmt psconvert -Tf map.ps&lt;/code&gt;
将其转换为多页PDF文件。&lt;/p&gt;

&lt;div class=&#34;notices warning&#34; &gt;&lt;p&gt;将多页PS文件转换为多页PDF文件时，&lt;code&gt;psconvert&lt;/code&gt; 的 &lt;code&gt;-A&lt;/code&gt; 和 &lt;code&gt;-P&lt;/code&gt; 等选项无法使用。&lt;/p&gt;
&lt;/div&gt;

</description>
    </item>
    
    <item>
      <title>GMT 5.2.1编译过程中NaN报错的解决办法</title>
      <link>http://gmt-china.org/blog/GMT5.2.1-NaN-bug/</link>
      <pubDate>Sat, 04 Jun 2016 00:00:00 +0000</pubDate>
      <author>admin@gmt-china.org (GMT 中文社区)</author>
      <guid>http://gmt-china.org/blog/GMT5.2.1-NaN-bug/</guid>
      <description>&lt;p&gt;在 Ubunut 16.04 或者其他比较新的 Linux 发行版下编译 GMT 5.2.1 的源码时，会出现如下错误而导致安装失败&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;non-floating-point argument in call to function &#39;__builtin_isnan&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;解决办法是，找到源码 &lt;code&gt;gmt-5.2.1/src/xyz2grd.c&lt;/code&gt;，将第752行的&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;(GMT_is_dnan (GMT-&amp;gt;common.d.active[GMT_IN])) ? sprintf (e_value, &amp;quot;NaN&amp;quot;) : sprintf (e_value, GMT-&amp;gt;current.setting.format_float_out, GMT-&amp;gt;common.d.nan_proxy[GMT_IN]);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;改成&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;(GMT-&amp;gt;common.d.active[GMT_IN]) ? sprintf (e_value, GMT-&amp;gt;current.setting.format_float_out, GMT-&amp;gt;common.d.nan_proxy[GMT_IN]) : sprintf (e_value, &amp;quot;NaN&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;再编译即可。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>